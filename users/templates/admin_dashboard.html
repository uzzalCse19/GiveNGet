{% extends 'base.html' %}
{% load admin_filters %}

{% load static %}

{% block title %}Admin Dashboard - GiveNGet{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css" rel="stylesheet">
<style>
    .dashboard-container {
        display: flex;
        min-height: 100vh;
        background: #f8fafc;
    }
    
    .sidebar {
        width: 280px;
        background: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
    }
    
    .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 2rem;
    }
    
    .sidebar-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .sidebar-menu {
        padding: 1rem 0;
    }
    
    .menu-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        color: #6b7280;
        text-decoration: none;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
    }
    
    .menu-item:hover {
        background: #f3f4f6;
        color: #374151;
        border-left-color: #d1d5db;
    }
    
    .menu-item.active {
        background: #eff6ff;
        color: #2563eb;
        border-left-color: #2563eb;
    }
    
    .menu-item i {
        width: 20px;
        margin-right: 0.75rem;
    }
    
    .admin-stat-card {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        border-left: 4px solid;
        transition: all 0.3s ease;
    }
    
    .admin-stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .content-section {
        display: none;
    }
    
    .content-section.active {
        display: block;
    }
    
    .action-btn {
        padding: 0.25rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn-suspend { background: #fef3c7; color: #92400e; }
    .btn-activate { background: #d1fae5; color: #065f46; }
    .btn-delete { background: #fee2e2; color: #991b1b; }
    .btn-edit { background: #dbeafe; color: #1e40af; }
    
    .action-btn:hover {
        transform: scale(1.05);
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 class="text-xl font-bold">GiveNGet Admin</h2>
            <p class="text-blue-100 text-sm mt-1">Management Panel</p>
        </div>
        
        <div class="sidebar-menu">
            <a href="?section=overview" class="menu-item {% if active_section == 'overview' %}active{% endif %}">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard Overview
            </a>
            <a href="?section=users" class="menu-item {% if active_section == 'users' %}active{% endif %}">
                <i class="fas fa-users"></i>
                Manage Users
            </a>
            <a href="?section=posts" class="menu-item {% if active_section == 'posts' %}active{% endif %}">
                <i class="fas fa-gift"></i>
                Manage Posts
            </a>
            <a href="?section=requests" class="menu-item {% if active_section == 'requests' %}active{% endif %}">
                <i class="fas fa-exchange-alt"></i>
                Manage Requests
            </a>
            <a href="?section=categories" class="menu-item {% if active_section == 'categories' %}active{% endif %}">
                <i class="fas fa-tags"></i>
                Manage Categories
            </a>
            
            <div class="px-4 py-3 mt-4 border-t">
                <a href="{% url 'post_list' %}" class="menu-item">
                    <i class="fas fa-external-link-alt"></i>
                    View Public Site
                </a>
                <a href="/admin/" class="menu-item">
                    <i class="fas fa-cog"></i>
                    Django Admin
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Overview Section -->
        <div id="overview-section" class="content-section {% if active_section == 'overview' %}active{% endif %}">
            {% include 'admin_sections/overview.html' %}
        </div>

        <!-- Users Section -->
        <div id="users-section" class="content-section {% if active_section == 'users' %}active{% endif %}">
            {% include 'admin_sections/users.html' %}
        </div>

        <!-- Posts Section -->
        <div id="posts-section" class="content-section {% if active_section == 'posts' %}active{% endif %}">
            {% include 'admin_sections/posts.html' %}
        </div>

        <!-- Requests Section -->
        <div id="requests-section" class="content-section {% if active_section == 'requests' %}active{% endif %}">
            {% include 'admin_sections/requests.html' %}
        </div>

        <!-- Categories Section -->
        <div id="categories-section" class="content-section {% if active_section == 'categories' %}active{% endif %}">
            {% include 'admin_sections/categories.html' %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    // Initialize charts for overview section
    function initializeCharts() {
        // User Status Chart
        const userStatusCtx = document.getElementById('userStatusChart')?.getContext('2d');
        if (userStatusCtx) {
            new Chart(userStatusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Inactive', 'Suspended'],
                    datasets: [{
                        data: [{{ active_users }}, {{ total_users|add:"-active_users"|add:"-suspended_users" }}, {{ suspended_users }}],
                        backgroundColor: ['#10B981', '#6B7280', '#EF4444'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeCharts();
        
        // Handle confirmation for delete actions
        document.querySelectorAll('form[data-confirm]').forEach(form => {
            form.addEventListener('submit', function(e) {
                if (!confirm(this.getAttribute('data-confirm'))) {
                    e.preventDefault();
                }
            });
        });
    });
</script>
{% endblock %}