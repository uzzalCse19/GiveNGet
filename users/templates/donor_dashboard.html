{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Upohar{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard Styles */
    .dashboard-container {
        display: flex;
        min-height: calc(100vh - 80px);
        background-color: #f8f9fa;
    }
    
    .dashboard-sidebar {
        width: 250px;
        background: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        padding: 20px 0;
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
    }
    
    .dashboard-content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
    }
    
    .user-profile-card {
        text-align: center;
        padding: 20px;
        border-bottom: 1px solid #eee;
    }
    
    .profile-photo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 15px;
        border: 3px solid #4CAF50;
    }
    
    .user-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .user-email {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .user-badge {
        display: inline-block;
        background: #e3f2fd;
        color: #1976d2;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .nav-section {
        margin-top: 20px;
    }
    
    .nav-title {
        padding: 10px 20px;
        font-size: 0.8rem;
        text-transform: uppercase;
        color: #666;
        font-weight: 600;
    }
    
    .nav-item {
        display: block;
        padding: 12px 20px;
        color: #333;
        text-decoration: none;
        transition: all 0.3s;
        border-left: 3px solid transparent;
    }
    
    .nav-item:hover {
        background-color: #f5f5f5;
        color: #4CAF50;
    }
    
    .nav-item.active {
        background-color: #e8f5e9;
        color: #4CAF50;
        border-left-color: #4CAF50;
        font-weight: 500;
    }
    
    .nav-item i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 1.5rem;
    }
    
    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    .section-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #333;
    }
    
    .content-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        margin-bottom: 30px;
    }
    
    .table-responsive {
        overflow-x: auto;
    }
    
    .dashboard-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .dashboard-table th {
        background-color: #f5f5f5;
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
        color: #333;
        border-bottom: 1px solid #ddd;
    }
    
    .dashboard-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #eee;
    }
    
    .dashboard-table tr:last-child td {
        border-bottom: none;
    }
    
    .dashboard-table tr:hover {
        background-color: #f9f9f9;
    }
    
    .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .status-available {
        background-color: #e8f5e9;
        color: #4CAF50;
    }
    
    .status-pending {
        background-color: #fff3e0;
        color: #ff9800;
    }
    
    .status-requested {
        background-color: #e3f2fd;
        color: #2196f3;
    }
    
    .status-completed {
        background-color: #f3e5f5;
        color: #9c27b0;
    }
    
    .status-rejected {
        background-color: #ffebee;
        color: #f44336;
    }
    
    .action-btn {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 0.8rem;
        text-decoration: none;
        margin-right: 5px;
        transition: all 0.3s;
    }
    
    .btn-view {
        background-color: #e3f2fd;
        color: #2196f3;
    }
    
    .btn-edit {
        background-color: #fff3e0;
        color: #ff9800;
    }
    
    .btn-delete {
        background-color: #ffebee;
        color: #f44336;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }
    
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: #ddd;
    }
    
    .empty-state p {
        margin-bottom: 20px;
    }
    
    .btn-primary {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.3s;
    }
    
    .btn-primary:hover {
        background-color: #388E3C;
    }
    
    /* Responsive adjustments */
    @media (max-width: 992px) {
        .dashboard-container {
            flex-direction: column;
        }
        
        .dashboard-sidebar {
            width: 100%;
            height: auto;
            position: relative;
        }
        
        .nav-items {
            display: flex;
            overflow-x: auto;
            padding: 0 10px;
        }
        
        .nav-item {
            white-space: nowrap;
            border-left: none;
            border-bottom: 3px solid transparent;
        }
        
        .nav-item.active {
            border-left: none;
            border-bottom-color: #4CAF50;
        }
    }
    
    @media (max-width: 576px) {
        .dashboard-content {
            padding: 15px;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="dashboard-sidebar">
        <div class="user-profile-card">
            {% if user.profile_photo %}
                <img src="{{ user.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
            {% else %}
                <img src="{% static 'images/default-avatar.png' %}" alt="Profile Photo" class="profile-photo">
            {% endif %}
            <div class="user-name">{{ user.name }}</div>
            <div class="user-email">{{ user.email }}</div>
            <div class="user-badge">{{ user.badge_level }}</div>
        </div>
        
        <div class="nav-section">
            <div class="nav-title">Main Navigation</div>
            <div class="nav-items">
                <a href="?section=overview" class="nav-item {% if active_section == 'overview' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i> Overview
                </a>
                <a href="?section=my_posts" class="nav-item {% if active_section == 'my_posts' %}active{% endif %}">
                    <i class="fas fa-gift"></i> My Posts
                </a>
                <a href="?section=my_requests" class="nav-item {% if active_section == 'my_requests' %}active{% endif %}">
                    <i class="fas fa-paper-plane"></i> Sent Requests
                </a>
                <a href="?section=received_requests" class="nav-item {% if active_section == 'received_requests' %}active{% endif %}">
                    <i class="fas fa-inbox"></i> Received Requests
                </a>
            </div>
        </div>
        
        <div class="nav-section">
            <div class="nav-title">Quick Actions</div>
            <div class="nav-items">
                <a href="{% url 'create_post' %}" class="nav-item">
                    <i class="fas fa-plus-circle"></i> Create New Post
                </a>
                <a href="{% url 'browse' %}" class="nav-item">
                    <i class="fas fa-search"></i> Browse Items
                </a>
                <a href="{% url 'profile' %}" class="nav-item">
                    <i class="fas fa-user-edit"></i> Edit Profile
                </a>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="dashboard-content">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        {% if active_section == 'overview' %}
            <!-- Overview Section -->
            <div class="section-header">
                <h1 class="section-title">Dashboard Overview</h1>
                <div class="section-actions">
                    <a href="{% url 'create_post' %}" class="btn-primary">
                        <i class="fas fa-plus"></i> New Post
                    </a>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e8f5e9; color: #4CAF50;">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="stat-value">{{ total_posts }}</div>
                    <div class="stat-label">Total Posts</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e3f2fd; color: #2196f3;">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="stat-value">{{ available_posts }}</div>
                    <div class="stat-label">Available Items</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #fff3e0; color: #ff9800;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-value">{{ requested_posts }}</div>
                    <div class="stat-label">Requested Items</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #f3e5f5; color: #9c27b0;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-value">{{ completed_posts }}</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e3f2fd; color: #2196f3;">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <div class="stat-value">{{ pending_requests_sent }}</div>
                    <div class="stat-label">Pending Requests Sent</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e8f5e9; color: #4CAF50;">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-value">{{ approved_requests_sent }}</div>
                    <div class="stat-label">Approved Requests Sent</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #fff3e0; color: #ff9800;">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <div class="stat-value">{{ pending_requests_received }}</div>
                    <div class="stat-label">Pending Requests Received</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e8f5e9; color: #4CAF50;">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="stat-value">{{ approved_requests_received }}</div>
                    <div class="stat-label">Approved Requests Received</div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="content-card">
                <h2 class="section-title" style="margin-top: 0;">Recent Activity</h2>
                
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Item</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for post in posts %}
                            <tr>
                                <td>
                                    <span class="status-badge {% if post.type == 'donation' %}status-available{% else %}status-pending{% endif %}">
                                        {{ post.get_type_display }}
                                    </span>
                                </td>
                                <td>{{ post.title }}</td>
                                <td>
                                    <span class="status-badge 
                                        {% if post.status == 'available' %}status-available
                                        {% elif post.status == 'requested' %}status-requested
                                        {% elif post.status == 'completed' %}status-completed
                                        {% endif %}">
                                        {{ post.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ post.created_at|date:"M d, Y" }}</td>
                                <td>
                                    <a href="{% url 'post_detail' post.id %}" class="action-btn btn-view">View</a>
                                    {% if post.status == 'available' %}
                                    <a href="{% url 'edit_post' post.id %}" class="action-btn btn-edit">Edit</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No posts yet. <a href="{% url 'create_post' %}">Create your first post</a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Community Stats -->
            <div class="content-card">
                <h2 class="section-title" style="margin-top: 0;">Community Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ total_users }}</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ total_requests }}</div>
                        <div class="stat-label">Total Requests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ active_categories }}</div>
                        <div class="stat-label">Active Categories</div>
                    </div>
                </div>
            </div>
            
        {% elif active_section == 'my_posts' %}
            <!-- My Posts Section -->
            <div class="section-header">
                <h1 class="section-title">My Posts</h1>
                <div class="section-actions">
                    <a href="{% url 'create_post' %}" class="btn-primary">
                        <i class="fas fa-plus"></i> New Post
                    </a>
                </div>
            </div>
            
            <div class="content-card">
                {% if user_posts %}
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for post in user_posts %}
                            <tr>
                                <td>{{ post.title }}</td>
                                <td>
                                    <span class="status-badge {% if post.type == 'donation' %}status-available{% else %}status-pending{% endif %}">
                                        {{ post.get_type_display }}
                                    </span>
                                </td>
                                <td>{% if post.category %}{{ post.category.name }}{% else %}Uncategorized{% endif %}</td>
                                <td>
                                    <span class="status-badge 
                                        {% if post.status == 'available' %}status-available
                                        {% elif post.status == 'requested' %}status-requested
                                        {% elif post.status == 'completed' %}status-completed
                                        {% endif %}">
                                        {{ post.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ post.created_at|date:"M d, Y" }}</td>
                                <td>
                                    <a href="{% url 'post_detail' post.id %}" class="action-btn btn-view">View</a>
                                    {% if post.status == 'available' %}
                                    <a href="{% url 'edit_post' post.id %}" class="action-btn btn-edit">Edit</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-gift"></i>
                    <h3>No Posts Yet</h3>
                    <p>You haven't created any posts yet. Start sharing items with the community!</p>
                    <a href="{% url 'create_post' %}" class="btn-primary">Create Your First Post</a>
                </div>
                {% endif %}
            </div>
            
        {% elif active_section == 'my_requests' %}
            <!-- My Requests Section -->
            <div class="section-header">
                <h1 class="section-title">My Sent Requests</h1>
            </div>
            
            <div class="content-card">
                {% if requests_sent %}
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Donor</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Message</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for request in requests_sent %}
                            <tr>
                                <td>{{ request.gift.title }}</td>
                                <td>{{ request.gift.donor.name }}</td>
                                <td>
                                    <span class="status-badge 
                                        {% if request.status == 'pending' %}status-pending
                                        {% elif request.status == 'approved' %}status-available
                                        {% elif request.status == 'rejected' %}status-rejected
                                        {% elif request.status == 'completed' %}status-completed
                                        {% endif %}">
                                        {{ request.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ request.created_at|date:"M d, Y" }}</td>
                                <td>{{ request.message|truncatewords:5 }}</td>
                                <td>
                                    <a href="{% url 'post_detail' request.gift.id %}" class="action-btn btn-view">View Item</a>
                                    {% if request.status == 'pending' %}
                                    <a href="#" class="action-btn btn-delete">Cancel</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-paper-plane"></i>
                    <h3>No Requests Sent</h3>
                    <p>You haven't sent any requests yet. Browse available items to make a request!</p>
                    <a href="{% url 'browse' %}" class="btn-primary">Browse Items</a>
                </div>
                {% endif %}
            </div>
            
        {% elif active_section == 'received_requests' %}
            <!-- Received Requests Section -->
            <div class="section-header">
                <h1 class="section-title">Received Requests</h1>
            </div>
            
            <div class="content-card">
                {% if requests_received %}
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Requester</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Message</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for request in requests_received %}
                            <tr>
                                <td>{{ request.gift.title }}</td>
                                <td>{{ request.requester.name }}</td>
                                <td>
                                    <span class="status-badge 
                                        {% if request.status == 'pending' %}status-pending
                                        {% elif request.status == 'approved' %}status-available
                                        {% elif request.status == 'rejected' %}status-rejected
                                        {% elif request.status == 'completed' %}status-completed
                                        {% endif %}">
                                        {{ request.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ request.created_at|date:"M d, Y" }}</td>
                                <td>{{ request.message|truncatewords:5 }}</td>
                                <td>
                                    <a href="{% url 'post_detail' request.gift.id %}" class="action-btn btn-view">View Item</a>
                                    {% if request.status == 'pending' %}
                                    <a href="#" class="action-btn btn-edit">Approve</a>
                                    <a href="#" class="action-btn btn-delete">Reject</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <h3>No Requests Received</h3>
                    <p>You haven't received any requests for your items yet.</p>
                    <a href="{% url 'create_post' %}" class="btn-primary">Create More Posts</a>
                </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add active class to current section in sidebar
    document.addEventListener('DOMContentLoaded', function() {
        // Handle responsive sidebar navigation
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                navItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Auto-dismiss alerts after 5 seconds
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.parentElement.removeChild(alert);
                    }
                }, 300);
            }, 5000);
        });
    });
</script>
{% endblock %}